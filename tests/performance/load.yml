config:
  target: 'http://localhost:3000'
  phases:
    # ウォームアップフェーズ
    - duration: 60
      arrivalRate: 5
      name: "ウォームアップ"
    # 負荷テストフェーズ
    - duration: 300
      arrivalRate: 20
      name: "負荷テスト"
    # ピーク負荷フェーズ
    - duration: 120
      arrivalRate: 50
      name: "ピーク負荷"
  processor: "./load-processor.js"
  variables:
    testUser:
      - "user@test.com"
      - "admin@test.com"
    testPassword: "Test123!"

scenarios:
  - name: "ホームページアクセス"
    weight: 30
    flow:
      - get:
          url: "/"
          headers:
            User-Agent: "Artillery Load Test"
      - think: 2

  - name: "ユーザー認証フロー"
    weight: 25
    flow:
      - post:
          url: "/api/auth/login"
          json:
            email: "{{ testUser }}"
            password: "{{ testPassword }}"
          capture:
            - header: "set-cookie"
              as: "sessionCookie"
      - get:
          url: "/api/users/profile"
          headers:
            Cookie: "{{ sessionCookie }}"
      - think: 3

  - name: "投稿検索"
    weight: 20
    flow:
      - get:
          url: "/api/search"
          qs:
            q: "デザイン"
            type: "posts"
      - think: 1

  - name: "投稿作成フロー"
    weight: 15
    flow:
      - function: "generateRandomPost"
      - post:
          url: "/api/auth/login"
          json:
            email: "user@test.com"
            password: "Test123!"
          capture:
            - header: "set-cookie"
              as: "sessionCookie"
      - post:
          url: "/api/posts"
          headers:
            Cookie: "{{ sessionCookie }}"
            Content-Type: "application/json"
          json:
            title: "{{ postTitle }}"
            content: "{{ postContent }}"
            type: "general"
            isPublic: true
      - think: 5

  - name: "求人情報閲覧"
    weight: 10
    flow:
      - get:
          url: "/api/designer-jobs"
      - get:
          url: "/api/designer-jobs/1"
      - think: 2